<!DOCTYPE html>




<html class="theme-next pisces" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/tpaaaaaa.github.io/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/tpaaaaaa.github.io/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/tpaaaaaa.github.io/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/tpaaaaaa.github.io/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/tpaaaaaa.github.io/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/tpaaaaaa.github.io/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/tpaaaaaa.github.io/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="个人blog">
<meta property="og:type" content="website">
<meta property="og:title" content="Tian&#39;s Blog">
<meta property="og:url" content="https:&#x2F;&#x2F;tpaaaaaa.github.io&#x2F;page&#x2F;16&#x2F;index.html">
<meta property="og:site_name" content="Tian&#39;s Blog">
<meta property="og:description" content="个人blog">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/tpaaaaaa.github.io/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://tpaaaaaa.github.io/page/16/"/>





  <title>Tian's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/tpaaaaaa.github.io/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Tian's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">对未来真正的慷慨，在于把一切都献给现在.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/tpaaaaaa.github.io/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/tpaaaaaa.github.io/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tpaaaaaa.github.io/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/tpaaaaaa.github.io/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            Categories
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" target="_blank" rel="noopener" onclick="return false;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://tpaaaaaa.github.io/tpaaaaaa.github.io/2019/09/15/%5B%E7%AE%97%E6%B3%95%5D%E6%A0%91%E9%93%BE%E5%89%96%E5%88%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="我玩维恩不学q">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/tpaaaaaa.github.io/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tian's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/tpaaaaaa.github.io/2019/09/15/%5B%E7%AE%97%E6%B3%95%5D%E6%A0%91%E9%93%BE%E5%89%96%E5%88%86/" itemprop="url">[算法]树链剖分</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-15T17:02:25+08:00">
                2019-09-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/tpaaaaaa.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" itemprop="url" rel="index">
                    <span itemprop="name">数据结构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>视频链接<a href="https://www.bilibili.com/video/av62060264" target="_blank" rel="noopener">https://www.bilibili.com/video/av62060264</a></p>
<p>博文地址<a href="https://www.cnblogs.com/ivanovcraft/p/9019090.html" target="_blank" rel="noopener">https://www.cnblogs.com/ivanovcraft/p/9019090.html</a></p>
<p>变量含义</p>
<ul>
<li>f[u]保存结点u的父亲节点</li>
<li>d[u]保存结点u的深度值</li>
<li>size[u]保存以u为根的子树节点个数</li>
<li>son[u]保存重儿子</li>
<li>rk[u]保存当前</li>
<li>dfs标号在树中所对应的节点</li>
<li>top[u]保存当前节点所在链的顶端节点</li>
<li>id[u]保存树中每个节点剖分以后的新编号（DFS的执行顺序）  </li>
</ul>
<p>第一次DFS，求出每个节点的父节点，深度，重儿子，子树大小等数据</p>
<pre><code>void dfs1(int u,int fa,int depth)    //当前节点、父节点、层次深度
{
    f[u]=fa;
    d[u]=depth;
    size[u]=1;    //这个点本身size=1，子树的大小要包括自己哦
    for(int i=head[u]; i != -1;i=e[i].next)
    {
        int v=e[i].to;
        if(v==fa)
            continue;
        dfs1(v,u,depth+1);    //层次深度+1
        size[u]+=size[v];    //子节点的size已被处理，用它来更新父节点的size
        if(size[v]&gt;size[son[u]])
            son[u]=v;    //选取size最大的作为重儿子
    }
}
//外部进入
dfs1(root,0,1);</code></pre><p>第二遍dfs，然后连接重链，同时标记每一个节点的dfs序，并且为了用数据结构来维护重链，我们在dfs时保证一条重链上各个节点dfs序连续（即处理出数组top,id,rk）</p>
<pre><code>void dfs2(int u,int t)    //当前节点、重链顶端
{
    top[u]=t;
    id[u]=++cnt;    //标记dfs序
    rk[cnt]=u;      //序号cnt对应节点u
    if(!son[u])     //没有子节点
        return;
    dfs2(son[u],t);
/*我们选择优先进入重儿子来保证一条重链上各个节点dfs序连续，
一个点和它的重儿子处于同一条重链，所以重儿子所在重链的顶端还是t*/
    for(int i=head[u];i;i=e[i].next)
    {
        int v=e[i].to;
        if(v!=son[u]&amp;&amp;v!=f[u])
            dfs2(v,v);    //一个点位于轻链底端，那么它的top必然是它本身
    }
}</code></pre><p>两遍dfs就是树链剖分的主要处理，通过dfs我们已经保证<strong>一条重链上各个节点dfs序连续</strong>，那么可以想到，我们可以通过数据结构（以线段树为例）来维护一条重链的信息<br>回顾上文的那个题目，修改和查询操作原理是类似的，以查询操作为例，其实就是个LCA，不过这里使用了top来进行加速，因为top可以直接跳转到该重链的起始结点，轻链没有起始结点之说，他们的top就是自己。<strong>需要注意的是，每次循环只能跳一次，并且让结点深的那个来跳到top的位置，避免两个一起跳从而插肩而过。</strong></p>
<pre><code>int sum(int x,int y)
{
    int ans=0,fx=top[x],fy=top[y];
    while(fx!=fy)    //两点不在同一条重链
    {
        if(d[fx]&gt;=d[fy]) //要让父节点深度大的点先跳，这里是x先跳
        {
            ans+=query(id[fx],id[x],rt);    //线段树区间求和，处理这条重链的贡献
            x=f[fx],fx=top[x];    //将x设置成原链头的父亲结点，走轻边，继续循环
        }
        else
        {
            ans+=query(id[fy],id[y],rt);
            y=f[fy],fy=top[y];
        }
    }
    //循环结束，两点位于同一重链上，但两点不一定为同一点，所以我们还要统计这两点之间的贡献
    if(id[x]&lt;=id[y])
        ans+=query(id[x],id[y],rt);
    else
        ans+=query(id[y],id[x],rt);
    return ans;
}</code></pre><p>妙哉妙哉</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://tpaaaaaa.github.io/tpaaaaaa.github.io/2019/09/15/%5B%E7%AE%97%E6%B3%95%5D%E5%89%8D%E7%BC%80%E5%92%8C%E5%B7%AE%E5%88%86%E5%BF%AB%E9%80%9F%E5%B9%82/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="我玩维恩不学q">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/tpaaaaaa.github.io/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tian's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/tpaaaaaa.github.io/2019/09/15/%5B%E7%AE%97%E6%B3%95%5D%E5%89%8D%E7%BC%80%E5%92%8C%E5%B7%AE%E5%88%86%E5%BF%AB%E9%80%9F%E5%B9%82/" itemprop="url">[算法]前缀和 差分 快速幂</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-15T17:01:45+08:00">
                2019-09-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/tpaaaaaa.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" itemprop="url" rel="index">
                    <span itemprop="name">数据结构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>视频链接<a href="https://www.bilibili.com/video/av63194309" target="_blank" rel="noopener">https://www.bilibili.com/video/av63194309</a></p>
<h2 id="前缀和："><a href="#前缀和：" class="headerlink" title="前缀和："></a>前缀和：</h2><h3 id="一维前缀和"><a href="#一维前缀和" class="headerlink" title="一维前缀和"></a>一维前缀和</h3><p>这个优化主要是用来在O（1）时间内求出一个序列a中,a[i]+a[i+1]+……+a[j]的和。</p>
<p>具体原理十分简单：用sum[i]表示（a[1]+a[2]+……+a[i])，其中sum[0]=0，则（a[i]+a[i+1]+……+a[j]）即等于sum[j]-sum[i-1]。</p>
<h3 id="二维前缀和"><a href="#二维前缀和" class="headerlink" title="二维前缀和"></a>二维前缀和</h3><h3 id="二维前缀和-1"><a href="#二维前缀和-1" class="headerlink" title="二维前缀和"></a>二维前缀和</h3><p>同理，有一维就有二维。对于一个矩阵a，我们也能在O（1）时间内求出子矩阵[x1<del>x2][y1</del>y2]的和。</p>
<p>设sum[i][j]为子矩阵[1<del>i][1</del>j]的和。则由容斥原理得：</p>
<p>sum[0][j]=sum[i][0]=0</p>
<p>a[x1<del>x2][y1</del>y2]=sum[x2][y2]-sum[x1-1][y2]-sum[x2][y1-1]+sum[x1-1][y1-1]</p>
<h2 id="差分"><a href="#差分" class="headerlink" title="差分"></a>差分</h2><p>博文链接<a href="https://blog.csdn.net/weixin_38686780/article/details/88827686" target="_blank" rel="noopener">https://blog.csdn.net/weixin_38686780/article/details/88827686</a></p>
<p>众所周知，<strong>前缀和的差</strong> 是原序列，<strong>差分的和</strong> 是原序列</p>
<p>差分操作有助于把原序列上的“区间操作”转化为差分序列上的“单点操作”，在树上有着独特的应用。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://tpaaaaaa.github.io/tpaaaaaa.github.io/2019/09/14/%5B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%5D%E6%9B%BF%E7%BD%AA%E7%BE%8A%E6%A0%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="我玩维恩不学q">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/tpaaaaaa.github.io/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tian's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/tpaaaaaa.github.io/2019/09/14/%5B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%5D%E6%9B%BF%E7%BD%AA%E7%BE%8A%E6%A0%91/" itemprop="url">[数据结构]替罪羊树</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-14T12:38:29+08:00">
                2019-09-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/tpaaaaaa.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" itemprop="url" rel="index">
                    <span itemprop="name">数据结构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>替罪羊树是一棵不需要旋转操作的AVL树，因此比较简单，适合入门学习。</p>
<p>视频：<a href="https://www.bilibili.com/video/av58948184/?spm_id_from=333.788.videocard.0" target="_blank" rel="noopener">https://www.bilibili.com/video/av58948184/?spm_id_from=333.788.videocard.0</a></p>
<p>模板题：<a href="https://www.luogu.org/problem/P3369" target="_blank" rel="noopener">https://www.luogu.org/problem/P3369</a></p>
<p>树的节点 Node</p>
<pre><code>struct Node
{
    int l, r, val;
// l,r为子节点的下标，val为该节点的权值
    int siz, fac;
// siz为该子树的大小，fac为该子树在删除操作之后的大小
    bool exist;
// 该点是否存在
};</code></pre><p>新节点的构建</p>
<pre><code>//用val构建一个新的节点，now为他的地址
void newnode(int &amp;now, int val)
{
    now = ++cnt;
    tzy[now].val = val;
    tzy[now].siz = tzy[now].fac = 1;
    tzy[now].exist = true;
}</code></pre><p>添加节点的操作——add</p>
<pre><code>//在树中插入一个val的值
void add(int &amp;now, int val)
{
    if(now == 0)
    {
        newnode(now, val);//插入完成
        check(root, now); //从根节点开始往下找，看看是不是存在不平衡的点
        return;
    }
    tzy[now].siz++;
    tzy[now].fac++;

    if(val &lt; tzy[now].val)
        add(tzy[now].l, val);
    else
        add(tzy[now].r, val);
}</code></pre><p>删除操作 —— del</p>
<pre><code>//在树中删除权值为val的点,惰性删除
void del(int now, int val)
{

    if(tzy[now].exist &amp;&amp; tzy[now].val == val)
    {
        tzy[now].exist = false;
        tzy[now].fac --;
        check(root, now);
        return;
    }
    tzy[now].fac --;
    if(val &lt; tzy[now].val)
        del(tzy[now].l, val);
    else
        del(tzy[now].r, val);
}</code></pre><p>检查树是否需要重构——check</p>
<pre><code>void check(int &amp;now, int ori)
{
    if(now == ori)
        return;
        //该点不平衡,将其重构，更新
    if(imbalance(now))
    {
        rebuilt(now);
        update(root, now);
        return;
    }
    if(tzy[ori].val &lt; tzy[now].val)
        check(tzy[now].l, ori);
    else
        check(tzy[now].r, ori);
}</code></pre><p>判断某个点是否不平衡——imbalance</p>
<pre><code>bool imbalance(int now)
{
    if(max(tzy[tzy[now].l].siz, tzy[tzy[now].r].siz ) &gt; tzy[now].siz * alpha
       || tzy[now].siz - tzy[now].fac &gt; tzy[now].siz * 0.3 )
        return true;
    return false;
}</code></pre><p>重构函数——rebuilt</p>
<pre><code>void rebuilt(int &amp;now)
{
    vec.clear();
    ldr(now);
    if(vec.empty())
    {
        now = 0;
        return;
    }
    lift(0, vec.size() - 1, now);
}</code></pre><p>其中的中序遍历</p>
<pre><code>void ldr(int now)
{
    if(!now) return;
    ldr(tzy[now].l);
    if(tzy[now].exist)
        vec.push_back(now);
    ldr(tzy[now].r);
}</code></pre><p>以及lift函数</p>
<pre><code>void lift(int l, int r, int &amp;now)
{
    if(l == r)
    {
        now = vec[l];
        tzy[now].l = tzy[now].r = 0;
        tzy[now].siz = tzy[now].fac = 1;
        return;
    }
    int mid = md(l, r);
    while(l &lt; mid &amp;&amp; tzy[vec[mid]].val == tzy[vec[mid - 1]].val)
        mid --;
    now = vec[mid];
    if(l &lt; mid)
        lift(l, mid - 1, tzy[now].l);
    else
        tzy[now].l = 0;

    lift(mid + 1, r, tzy[now].r);
    tzy[now].siz = tzy[tzy[now].l].siz + tzy[tzy[now].r].siz + 1;
    tzy[now].fac = tzy[tzy[now].l].fac + tzy[tzy[now].r].fac + 1;

}</code></pre><p>祖父节点的siz更新</p>
<pre><code>void update(int now, int ori)
{
    if(!now)
        return;
    if(tzy[ori].val &lt; tzy[now].val)
        update(tzy[now].l, ori);
    else
        update(tzy[now].r, ori);

    tzy[now].siz = tzy[tzy[now].l].siz + tzy[tzy[now].r].siz + 1;

}</code></pre><p>查询值的排名——getrank</p>
<pre><code>int getrank(int val)
{
    int now = root;
    int rankk = 1;
    while(now)
    {
        if(val &lt;= tzy[now].val)
            now = tzy[now].l;
        else
        {
            rankk += tzy[now].exist + tzy[tzy[now].l].fac;
            now = tzy[now].r;
        }
    }
    return rankk;
}</code></pre><p>某个排名的值查询——getnum</p>
<pre><code>int getnum(int rak)
{
    int now = root;
    while(now)
    {
        if(tzy[tzy[now].l].fac + tzy[now].exist == rak)
            break;
        else if(tzy[tzy[now].l].fac &gt;= rak)
            now = tzy[now].l;
        else
        {
            rak -= tzy[tzy[now].l].fac + tzy[now].exist;
            now = tzy[now].r;
        }
    }
    return tzy[now].val;
}</code></pre><p>获得某个数的前驱和后继</p>
<pre><code>前驱：getnum(getrank(x) - 1)
后继：getnum(getrank(x + 1))</code></pre><p>完整的板子：</p>
<pre><code>//AC的板子
#include &lt;iostream&gt;
#include &lt;vector&gt;
#include &lt;cstdio&gt;
#define md(x, y)  (x + y) / 2
using namespace std;
const int MAXN = 1e5 + 10;
int cnt = 0, root;
vector &lt; int &gt; vec;
const double alpha = 0.75;
struct Node
{
    int l, r, val;
    int siz, fac;
    bool exist;
};
Node tzy[MAXN];
void newnode(int &amp;now, int val)
{
    now = ++cnt;
    tzy[now].l = tzy[now].r = 0;
    tzy[now].val = val;
    tzy[now].siz = tzy[now].fac = 1;
    tzy[now].exist = true;
}
bool imbalance(int now)
{
    if(max(tzy[tzy[now].l].siz, tzy[tzy[now].r].siz ) &gt; tzy[now].siz * alpha
       || tzy[now].siz - tzy[now].fac &gt; tzy[now].siz * 0.3 )
        return true;
        return false;
}
//将now为根的子树重建，首先用中序遍历
void ldr(int now)
{
    if(!now)
        return;
    ldr(tzy[now].l);
    if(tzy[now].exist)
        vec.push_back(now);
    ldr(tzy[now].r);
}
void lift(int l, int r, int &amp;now)
{
    if(l == r)
    {
        now = vec[l];
        tzy[now].l = tzy[now].r = 0;
        tzy[now].siz = tzy[now].fac = 1;
        return;
    }
    int mid = md(l, r);
    while(l &lt; mid &amp;&amp; tzy[vec[mid]].val == tzy[vec[mid - 1]].val)
        mid --;
    now = vec[mid];
    if(l &lt; mid)
        lift(l, mid - 1, tzy[now].l);
    else
        tzy[now].l = 0;
    lift(mid + 1, r, tzy[now].r);
    tzy[now].siz = tzy[tzy[now].l].siz + tzy[tzy[now].r].siz + 1;
    tzy[now].fac = tzy[tzy[now].l].fac + tzy[tzy[now].r].fac + 1;

}
int getrank(int val)
{
    int now = root;
    int rankk = 1;
    while(now)
    {
        if(val &lt;= tzy[now].val)
            now = tzy[now].l;
        else
        {
            rankk += tzy[now].exist + tzy[tzy[now].l].fac;
            now = tzy[now].r;
        }
    }
    return rankk;
}
int getnum(int rak)
{
    int now = root;
    while(now)
    {
        //??
        if(tzy[now].exist &amp;&amp; tzy[tzy[now].l].fac + tzy[now].exist == rak)
            break;
        else if(tzy[tzy[now].l].fac &gt;= rak)
            now = tzy[now].l;
        else
        {
            rak -= tzy[tzy[now].l].fac + tzy[now].exist;
            now = tzy[now].r;
        }

    }
    return tzy[now].val;
}
void update(int now, int ori)
{
    if(!now)
        return;
    if(tzy[ori].val &lt; tzy[now].val)
        update(tzy[now].l, ori);
    else
        update(tzy[now].r, ori);

    tzy[now].siz = tzy[tzy[now].l].siz + tzy[tzy[now].r].siz + 1;

}
void rebuilt(int &amp;now)
{
    vec.clear();
    ldr(now);
    if(vec.empty())
    {
        now = 0;
        return;
    }
    lift(0, vec.size() - 1, now);
}
void check(int &amp;now, int ori)
{
    if(now == ori)
        return;
        //该点不平衡,将其重构，更新
    if(imbalance(now))
    {
        rebuilt(now);
        update(root, now);
        return;
    }
    if(tzy[ori].val &lt; tzy[now].val)
        check(tzy[now].l, ori);
    else
        check(tzy[now].r, ori);
}
//在now这个位置插入val
void del(int now, int val)
{
    if(tzy[now].exist&amp;&amp;tzy[now].val == val)
    {
        tzy[now].exist = false;
        tzy[now].fac --;
        check(root, now);
        return;
    }
    tzy[now].fac --;
    if(val &lt; tzy[now].val)
        del(tzy[now].l, val);
    else
        del(tzy[now].r, val);
}
void add(int &amp;now, int val)
{
    if(now == 0)
    {
        newnode(now, val);//插入完成
        check(root, now); //从根节点开始往下找，看看是不是存在不平衡的点
        return;
    }
    tzy[now].siz++;
    tzy[now].fac++;
    if(val &lt; tzy[now].val)
        add(tzy[now].l, val);
    else
        add(tzy[now].r, val);
}

int main()
{
    cnt = 0;
    root = 0;
    int t, x, opt;
    cin &gt;&gt;t;
    while(t--)
    {
        scanf(&quot;%d%d&quot;, &amp;opt, &amp;x);
        switch(opt)
        {
            case 1:
                add(root, x);
                break;
            case 2:
                del(root, x);
                break;
            case 3:
                printf(&quot;%d\n&quot;, getrank(x));
                break;
            case 4:
                printf(&quot;%d\n&quot;, getnum(x));
                break;
            case 5:
                printf(&quot;%d\n&quot;, getnum(getrank(x) - 1));
                break;
            case 6:
                printf(&quot;%d\n&quot;, getnum(getrank(x + 1)));
        }
    }
}</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://tpaaaaaa.github.io/tpaaaaaa.github.io/2019/09/14/%5B%E9%9A%8F%E7%AC%94%5D%E4%B8%AD%E7%A7%8B%E4%B8%8D%E5%AE%9C%E6%95%B2%E4%BB%A3%E7%A0%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="我玩维恩不学q">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/tpaaaaaa.github.io/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tian's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/tpaaaaaa.github.io/2019/09/14/%5B%E9%9A%8F%E7%AC%94%5D%E4%B8%AD%E7%A7%8B%E4%B8%8D%E5%AE%9C%E6%95%B2%E4%BB%A3%E7%A0%81/" itemprop="url">[随笔]中秋不宜敲代码</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-14T08:14:20+08:00">
                2019-09-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/tpaaaaaa.github.io/categories/%E9%9A%8F%E7%AC%94/" itemprop="url" rel="index">
                    <span itemprop="name">随笔</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>敲了半小时代码，200+行，然后编译器卡了没保存，哭哭哭。心态炸</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://tpaaaaaa.github.io/tpaaaaaa.github.io/2019/09/14/%5B%E6%93%8D%E4%BD%9C%5DDFS%E5%BA%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="我玩维恩不学q">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/tpaaaaaa.github.io/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tian's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/tpaaaaaa.github.io/2019/09/14/%5B%E6%93%8D%E4%BD%9C%5DDFS%E5%BA%8F/" itemprop="url">[操作]DFS序</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-14T08:12:41+08:00">
                2019-09-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/tpaaaaaa.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" itemprop="url" rel="index">
                    <span itemprop="name">数据结构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>树通常有多种类型，但其终归是非线性结构，操作起来有时总是那么费时。</p>
<p>我们知道，树是一种非线性的数据结构，它的一些数据调用肯定是没有线性结构来得方便的。所以这个时候，dfs站了出来。基于dfs函数，我们可以在遍历的同时记录下每个节点进出栈的时间序列。就假设有这样一颗树： </p>
<p><img src="https://img-blog.csdn.net/20171103154348840?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzk2NzA0MzQ=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>dfs序就是： </p>
<p><img src="https://img-blog.csdn.net/20171103154427093?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMzk2NzA0MzQ=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>我们发现，一个点的进出栈的时间点之间的时间段就是它的子树在栈中的所有时间。也就是说，子树的dfs序肯定大于根节点的进栈时间小于根节点的出栈时间，这就成了一个区间问题。所以我们就把一个树上的问题“拍”到了一个线性的数据结构上面。区间问题就是贼好做的了，有各种强大的数据结构可以用来维护区间，例如线段树。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://tpaaaaaa.github.io/tpaaaaaa.github.io/2019/09/13/HDU1394MinimumInversionNumber/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="我玩维恩不学q">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/tpaaaaaa.github.io/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tian's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/tpaaaaaa.github.io/2019/09/13/HDU1394MinimumInversionNumber/" itemprop="url">HDU 1394 Minimum Inversion Number</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-13T23:11:47+08:00">
                2019-09-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/tpaaaaaa.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" itemprop="url" rel="index">
                    <span itemprop="name">数据结构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>The inversion number of a given number sequence a1, a2, …, an is the number of pairs (ai, aj) that satisfy i &lt; j and ai &gt; aj. </p>
<p>For a given sequence of numbers a1, a2, …, an, if we move the first m &gt;= 0 numbers to the end of the seqence, we will obtain another sequence. There are totally n such sequences as the following: </p>
<p>a1, a2, …, an-1, an (where m = 0 - the initial seqence)<br>a2, a3, …, an, a1 (where m = 1)<br>a3, a4, …, an, a1, a2 (where m = 2)<br>…<br>an, a1, a2, …, an-1 (where m = n-1) </p>
<p>You are asked to write a program to find the minimum inversion number out of the above sequences.<br>InputThe input consists of a number of test cases. Each case consists of two lines: the first line contains a positive integer n (n &lt;= 5000); the next line contains a permutation of the n integers from 0 to n-1.<br>OutputFor each case, output the minimum inversion number on a single line.<br>Sample Input</p>
<p>10<br>1 3 6 9 0 8 5 7 4 2</p>
<p>Sample Output</p>
<p>16</p>
<h2 id="分析："><a href="#分析：" class="headerlink" title="分析："></a>分析：</h2><p>要清楚整个数列的逆序数代表的含义，每个数的逆序数的含义。</p>
<p>复习一下用树状数组解普通逆序数问题</p>
<p>普通求逆序数的思路，将数列排序离散化，然后按原数列顺序从后往前依次将数放入（以离散化后的下标），然后用线段树维护离散化后的数， 可用树状数组解。</p>
<p>然后对逆序数这个这个数的性质进行思考<br>第一个数的逆序数，就是在他之后的，比他小的数<br>把第一个数移到最后去，则他的逆序数变成了0.<br>那些比他大的数，他们的逆序数都加1</p>
<p>那些比他小的数，逆序数没有发什么变化。</p>
<p>而第一个数的逆序数，就是比他小的数的数目<br>也就是统计一下，比第一个数大的数有哪些<br>那么这一次移动，总的逆序数的变化<br>sum = sum - (第一个数的逆序数) + 数列中比第一个数大的数的数目</p>
<p>= sum - (数列中比第一个数小的数的数目) + (数列中比第一个数大的数的数目)<br>用树状数组解出总的逆序数，和每个点的逆序数。</p>
<h2 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h2><pre><code>#include&lt;functional&gt;
#include&lt;cstdio&gt;
#include&lt;cstring&gt;
#include&lt;algorithm&gt;
#include&lt;iostream&gt;
#include&lt;string&gt;
#include&lt;vector&gt;
#include&lt;stack&gt;
#include&lt;bitset&gt;
#include&lt;cstdlib&gt;
#include&lt;cmath&gt;
#include&lt;set&gt;
#include&lt;list&gt;
#include&lt;deque&gt;
#include&lt;map&gt;
#include&lt;queue&gt;
#define md(x, y) (x + y) / 2
using namespace std;
typedef long long ll;
const double PI = acos(-1.0);
const double eps = 1e-6;
const int INF = 0x3f3f3f3f;
const int MAXN = 5e3 + 10;
int inverNum[MAXN];
int q;
int c[MAXN], a[MAXN], lisan[MAXN];
int lowbit(int x)
{
    return x&amp;(-x);
}
void update(int x, int v)
{
    for(int i = x; i &lt;= q; i += lowbit(i))
        c[i] += v;
}
int sum(int x)
{
    int ans = 0;
    for(int i = x; i &gt; 0; i -= lowbit(i))
        ans += c[i];
    return ans;
}
int binSearch(int x, int n)
{
    int l = 1;
    int r = n;
    while(l &lt;= r)
    {
        int mid = md(l, r);
        if(lisan[mid] == x)
            return mid;
        else if(lisan[mid] &gt; x)
            r = mid - 1;
        else
            l = mid + 1;
    }
}
int main()
{
    int n;
    while(scanf(&quot;%d&quot;, &amp;n) != EOF)
    {
        for(int i = 1; i &lt;= n; i++)
        {
            scanf(&quot;%d&quot;, &amp;a[i]);
            lisan[i] = a[i];
        }
        sort(lisan + 1, lisan + 1 + n);
        q = unique(lisan + 1, lisan + 1 + n) - (lisan + 1);
        memset(c, 0, sizeof c);
        int ans = 0;
        for(int i = n; i &gt; 0; i--)
        {
            int pos = binSearch(a[i], q);
            update(pos, 1);
            inverNum[i] = sum(pos - 1);
            ans += inverNum[i];
        }
        //第一次移第一个数，第二个以第二个数
        for(int i = 1; i &lt; n; i++)
        {
            inverNum[i] = 0;
            int temp = 0;
            for(int j = 1; j &lt;= n; j++)
                if(i != j &amp;&amp; a[j] &gt; a[i])
                    inverNum[j]++;
            for(int j = 1; j &lt;= n; j++)
                temp += inverNum[j];

            ans = min(ans, temp);
        }
        printf(&quot;%d\n&quot;, ans);

    }
    return 0;
}</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://tpaaaaaa.github.io/tpaaaaaa.github.io/2019/09/13/%5B%E4%B8%93%E9%A2%98%5D%E7%BA%BF%E6%AE%B5%E6%A0%91%E4%B8%93%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="我玩维恩不学q">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/tpaaaaaa.github.io/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tian's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/tpaaaaaa.github.io/2019/09/13/%5B%E4%B8%93%E9%A2%98%5D%E7%BA%BF%E6%AE%B5%E6%A0%91%E4%B8%93%E9%A2%98/" itemprop="url">[专题]线段树专题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-13T15:52:07+08:00">
                2019-09-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/tpaaaaaa.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" itemprop="url" rel="index">
                    <span itemprop="name">数据结构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>刷题： 人一我百，人百我万</p>
<h2 id="第一部分-单点更新："><a href="#第一部分-单点更新：" class="headerlink" title="第一部分 单点更新："></a>第一部分 单点更新：</h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://tpaaaaaa.github.io/tpaaaaaa.github.io/2019/09/13/HDU3974Assignthetask/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="我玩维恩不学q">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/tpaaaaaa.github.io/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tian's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/tpaaaaaa.github.io/2019/09/13/HDU3974Assignthetask/" itemprop="url">HDU 3974 Assign the task</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-13T11:30:52+08:00">
                2019-09-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/tpaaaaaa.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" itemprop="url" rel="index">
                    <span itemprop="name">数据结构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>There is a company that has N employees(numbered from 1 to N),every employee in the company has a immediate boss (except for the leader of whole company).If you are the immediate boss of someone,that person is your subordinate, and all his subordinates are your subordinates as well. If you are nobody’s boss, then you have no subordinates,the employee who has no immediate boss is the leader of whole company.So it means the N employees form a tree. </p>
<p>The company usually assigns some tasks to some employees to finish.When a task is assigned to someone,He/She will assigned it to all his/her subordinates.In other words,the person and all his/her subordinates received a task in the same time. Furthermore,whenever a employee received a task,he/she will stop the current task(if he/she has) and start the new one. </p>
<p>Write a program that will help in figuring out some employee’s current task after the company assign some tasks to some employee.InputThe first line contains a single positive integer T( T &lt;= 10 ), indicates the number of test cases. </p>
<p>For each test case: </p>
<p>The first line contains an integer N (N ≤ 50,000) , which is the number of the employees. </p>
<p>The following N - 1 lines each contain two integers u and v, which means the employee v is the immediate boss of employee u(1&lt;=u,v&lt;=N). </p>
<p>The next line contains an integer M (M ≤ 50,000). </p>
<p>The following M lines each contain a message which is either </p>
<p>“C x” which means an inquiry for the current task of employee x </p>
<p>or </p>
<p>“T x y”which means the company assign task y to employee x. </p>
<p>(1&lt;=x&lt;=N,0&lt;=y&lt;=10^9)OutputFor each test case, print the test case number (beginning with 1) in the first line and then for every inquiry, output the correspond answer per line.Sample Input</p>
<p>1<br>5<br>4 3<br>3 2<br>1 3<br>5 2<br>5<br>C 3<br>T 2 1<br> C 3<br>T 3 2<br>C 3</p>
<p>Sample Output</p>
<p>Case #1:<br>-1<br>1<br>2</p>
<h2 id="分析："><a href="#分析：" class="headerlink" title="分析："></a>分析：</h2><p>妙哉妙哉</p>
<p>首先根据领导关系，构建一棵树，显然这是一棵有根树，我们从根开始dfs，得到一个dfs序，记录每个点first[u] 和last[u]，也就是这个点第一次出现在dfs序中的位置和最后一次出现在dfs序中的位置， 显然dfs序中first[u] 到 last[u]中的节点，间接或者直接由u控制，因此每次对u的任务下达，我们就可以将dfs序中[ first, last]这个区间里面的节点的任务都变成u的任务，所以用线段树来维护区间信息。</p>
<h2 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h2><p>输入部分</p>
<pre><code>scanf(&quot;%d&quot;, &amp;n);
for(int i = 1; i &lt;= n; i++)
{
    in[i] = 0;
    emp[i].clear();
}
for(int i = 1; i &lt;= n - 1; i++)
{
    int x, y;
    scanf(&quot;%d%d&quot;, &amp;x, &amp;y);
    emp[y].push_back(x);   
    in[x] ++;
    //入度为0说明是大boss
}
cnt = 0;
int k = 0;
for(int i = 1; i &lt;= n; i++)
    if(in[i] == 0)
    {
        k = i;
        break;
    }
memset(vis, false, sizeof vis);
dfs(k);//从大boss开始dfs
built(1, 1, cnt); //以dfs序建立一棵树</code></pre><p>树的建立</p>
<pre><code>void built(int rt, int l, int r)
{
    node[rt].l = l;
    node[rt].r = r;
    node[rt].lazy = -1;
    if(l == r)
        return;
    int mid = md(l, r);
    built(ls(rt), l, mid);
    built(rs(rt), mid + 1, r);
}</code></pre><p>接下来的操作</p>
<pre><code>for(int i = 1; i &lt;= m; i++)
{
    cin &gt;&gt; c;
    if(c == &apos;C&apos;)
    {
        int x;
        scanf(&quot;%d&quot;, &amp;x);
        int ans = query(1, first[x]);
        printf(&quot;%d\n&quot;, ans);
    }
    else
    {
        int x, y;
        scanf(&quot;%d%d&quot;, &amp;x, &amp;y);
        update(1, first[x], last[x], y);
    }
}</code></pre><p>update函数</p>
<pre><code>void update(int rt, int l, int r, int v)
{
    if(node[rt].l == l &amp;&amp; node[rt].r == r)
    {
        node[rt].lazy = v;
        return;
    }
    pushDown(rt);
    int mid = md(node[rt].l, node[rt].r);
    if(r &lt;= mid)
        update(ls(rt), l, r, v);
    else if(l &gt; mid)
        update(rs(rt), l, r, v);
    else
    {
        update(ls(rt), l, mid, v);
        update(rs(rt), mid + 1, r, v);
    }
}</code></pre><p>查询部分</p>
<pre><code>// 返回第pos人的lazy值
int query(int rt, int pos)
{
    if(node[rt].l == node[rt].r)
        return node[rt].lazy;
    pushDown(rt);
    int mid = md(node[rt].l, node[rt].r);       //我可以骂人吗
    if(pos &lt;= mid)
        return query(ls(rt), pos);
    else
        return query(rs(rt), pos);
}</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://tpaaaaaa.github.io/tpaaaaaa.github.io/2019/09/13/HDU-4027Canyouanswerthesequeries/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="我玩维恩不学q">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/tpaaaaaa.github.io/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tian's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/tpaaaaaa.github.io/2019/09/13/HDU-4027Canyouanswerthesequeries/" itemprop="url">HDU - 4027 Can you answer these queries?</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-13T11:21:57+08:00">
                2019-09-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/tpaaaaaa.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" itemprop="url" rel="index">
                    <span itemprop="name">数据结构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>A lot of battleships of evil are arranged in a line before the battle. Our commander decides to use our secret weapon to eliminate the battleships. Each of the battleships can be marked a value of endurance. For every attack of our secret weapon, it could decrease the endurance of a consecutive part of battleships by make their endurance to the square root of it original value of endurance. During the series of attack of our secret weapon, the commander wants to evaluate the effect of the weapon, so he asks you for help.<br>You are asked to answer the queries that the sum of the endurance of a consecutive part of the battleship line. </p>
<p>Notice that the square root operation should be rounded down to integer.InputThe input contains several test cases, terminated by EOF.<br>  For each test case, the first line contains a single integer N, denoting there are N battleships of evil in a line. (1 &lt;= N &lt;= 100000)<br>  The second line contains N integers Ei, indicating the endurance value of each battleship from the beginning of the line to the end. You can assume that the sum of all endurance value is less than 2 63.<br>  The next line contains an integer M, denoting the number of actions and queries. (1 &lt;= M &lt;= 100000)<br>  For the following M lines, each line contains three integers T, X and Y. The T=0 denoting the action of the secret weapon, which will decrease the endurance value of the battleships between the X-th and Y-th battleship, inclusive. The T=1 denoting the query of the commander which ask for the sum of the endurance value of the battleship between X-th and Y-th, inclusive.<br>OutputFor each test case, print the case number at the first line. Then print one line for each query. And remember follow a blank line after each test case.Sample Input</p>
<p>10<br>1 2 3 4 5 6 7 8 9 10<br>5<br>0 1 10<br>1 1 10<br>1 1 5<br>0 5 8<br>1 4 8</p>
<p>Sample Output</p>
<p>Case #1:<br>19<br>7<br>6</p>
<h2 id="分析："><a href="#分析：" class="headerlink" title="分析："></a>分析：</h2><p>0操作是将[x, y]区间里面的数都开方，1操作是求[x, y]区间和。由题知道，给定树列上的数，最多为2^64，也就是说开一次就是2^32，再开一次就是2^16 , 2^8. 2^4 . 2^2 2 1 ,也就是说，每个数最多开7次，所以可以用这个来剪枝。如果某个区间和 == 区间长度，说明区间里面的数都是1，就剪枝不需要操作，不然的话就单个单个开方。</p>
<h2 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h2><p>线段树的构建</p>
<pre><code>void built(int rt, int l, int r)
{
    node[rt].l = l;
    node[rt].r = r;
    if(l == r)
    {
        node[rt].sum = a[l];
        return;
    }

    int mid = md(l, r);
    built(ls(rt), l, mid);
    built(rs(rt), mid + 1, r);
    pushUp(rt);
}</code></pre><p>输入部分</p>
<pre><code>for(int i = 1; i &lt;= m; i++)
{
    int t, x, y;
    scanf(&quot;%d%d%d&quot;, &amp;t, &amp;x, &amp;y);
    if(y &lt; x)
        swap(x, y); //这是个什么傻逼坑点？？？
    if(t == 0)
    {
        update(1, x, y);
    }
    else
    {
        ll ans = query(1, x, y);
        printf(&quot;%lld\n&quot;, ans);
    }
}</code></pre><p>update部分</p>
<pre><code>//将[l, r]这个区间里面的值全部开根号
void update(int rt, int l, int r)
{
    if(node[rt].sum == (node[rt].r - node[rt].l +1))
        return;     //说明没有操作的必要了
    if(node[rt].l == node[rt].r) //单点更新到底了
    {
        if(node[rt].sum != 1)
            node[rt].sum = (int)sqrt(double(node[rt].sum));
        return;
    }
    int mid = md(node[rt].l, node[rt].r);

    if(r &lt;= mid)
        update(ls(rt), l, r);
    else if (l &gt; mid)
        update(rs(rt), l, r);
    else
    {
        update(ls(rt), l, mid);
        update(rs(rt), mid + 1, r);
    }
    pushUp(rt);
}</code></pre><p>查询部分</p>
<pre><code>//返回[l, r]区间和
ll query(int rt, int l, int r)
{
    if(node[rt].l == l &amp;&amp; node[rt].r == r)
        return node[rt].sum;
    int mid = md(node[rt].l, node[rt].r);
    if(r &lt;= mid)
        return query(ls(rt), l, r);
    else if(l &gt; mid)
        return query(rs(rt), l, r);
    else
        return query(ls(rt), l, mid) + query(rs(rt), mid + 1, r);
}</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://tpaaaaaa.github.io/tpaaaaaa.github.io/2019/09/13/HDU4417SuperMario/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="我玩维恩不学q">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/tpaaaaaa.github.io/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tian's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/tpaaaaaa.github.io/2019/09/13/HDU4417SuperMario/" itemprop="url">HDU 4417 Super Mario</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-13T11:07:13+08:00">
                2019-09-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/tpaaaaaa.github.io/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" itemprop="url" rel="index">
                    <span itemprop="name">数据结构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Mario is world-famous plumber. His “burly” figure and amazing jumping ability reminded in our memory. Now the poor princess is in trouble again and Mario needs to save his lover. We regard the road to the boss’s castle as a line (the length is n), on every integer point i there is a brick on height hi. Now the question is how many bricks in [L, R] Mario can hit if the maximal height he can jump is H.InputThe first line follows an integer T, the number of test data.<br>For each test data:<br>The first line contains two integers n, m (1 &lt;= n &lt;=10^5, 1 &lt;= m &lt;= 10^5), n is the length of the road, m is the number of queries.<br>Next line contains n integers, the height of each brick, the range is [0, 1000000000].<br>Next m lines, each line contains three integers L, R,H.( 0 &lt;= L &lt;= R &lt; n 0 &lt;= H &lt;= 1000000000.)OutputFor each case, output “Case X: “ (X is the case number starting from 1) followed by m lines, each line contains an integer. The ith integer is the number of bricks Mario can hit for the ith query.<br>Sample Input</p>
<p>1<br>10 10<br>0 5 2 7 5 4 3 8 7 7<br>2 8 6<br>3 5 0<br>1 3 1<br>1 9 4<br>0 1 0<br>3 5 5<br>5 5 1<br>4 6 3<br>1 5 7<br>5 7 3</p>
<p>Sample Output</p>
<p>Case 1:<br>4<br>0<br>0<br>3<br>1<br>2<br>0<br>1<br>5<br>1</p>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析:"></a>分析:</h2><p>给一个数列，问这个数列里面的某个区间[L, R]中 比H小or 等的数目有多少个</p>
<p>主席树。</p>
<h2 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h2><p>输入和离散化以及主席树初始化</p>
<pre><code>scanf(&quot;%d%d&quot;, &amp;n, &amp;m);
for(int i = 1; i &lt;= n; i++)
{
    scanf(&quot;%d&quot;, &amp;a[i]);
    lisan[i] = a[i];
}
sort(lisan + 1, lisan + 1 + n);
int q = unique(lisan + 1, lisan + 1 + n) - (lisan + 1);
cnt = 0;
root[0] = 0;
node[0].lson = node[0].rson = node[0].sum = 0;</code></pre><p>建立第1 … n棵主席树</p>
<pre><code>for(int i = 1; i &lt;= n; i++)
{
    int pos = binSearch(a[i], q);
    root[i] = root[i - 1];
    update(pos, root[i], 1, q);
}</code></pre><p>主席树的构建——update（是不是叫built更合适）</p>
<pre><code>void update(int pos, int &amp;root, int L, int R)
{
    cnt ++;
    node[cnt] = node[root];
    root = cnt;
    node[cnt].sum++;
    if(L == R)
        return;     //已经递归到pos位了
    int mid = md(L, R);

    if(pos &lt;= mid)  //pos位要小于mid位，说明左子树要改
        update(pos, node[root].lson, L, mid);
    else
        update(pos, node[root].rson, mid + 1, R);
}</code></pre><p>接下来是查询第[x, y]区间中比h小或等的数目</p>
<pre><code>for(int i = 1; i &lt;= m; i++)
{
    scanf(&quot;%d%d%d&quot;, &amp;x, &amp;y, &amp;k);
    x++;
    y++; //孤儿题目
    //不是求[x, y]区间中第k大的数，而是比k小于等于的数的数目
    int pos = query(root[x - 1], root[y], k, 1, q);
    printf(&quot;%d\n&quot;, pos);
}</code></pre><p>查询部分</p>
<pre><code>int query(int i, int j, int k, int L, int R)
{
 //o记录的是原数列中[L, R]区间数的总数
    int o = node[j].sum - node[i].sum;      //[L, R]这个区间里面的总次数
    if(L == R)
    {
        if(k &gt;= lisan[L])
            return o;
        else
            return 0;
    }
    int ld = node[node[j].lson].sum - node[node[i].lson].sum; 
//ld记录的是原数列中[L, R]区间中  位于离散化后数组前半部分的数的数目
    int rd = node[node[j].rson].sum - node[node[i].rson].sum;   //[mid + 1, R] 这里面的次数
    int mid = md(L, R);     //返回的是在离散数组中的下标
    if( k &lt;= lisan[mid])   
        return query(node[i].lson, node[j].lson, k, L, mid);
    else
        return query(node[i].rson, node[j].rson, k, mid + 1, R) + ld;
}</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
 <nav class="pagination">
   <a class="extend prev" rel="prev" href="/tpaaaaaa.github.io/page/15/"><i class="fa fa-angle-left" aria-label="accessibility.prev_page"></i></a><a class="page-number" href="/tpaaaaaa.github.io/">1</a><span class="space">&hellip;</span><a class="page-number" href="/tpaaaaaa.github.io/page/15/">15</a><span class="page-number current">16</span><a class="page-number" href="/tpaaaaaa.github.io/page/17/">17</a><span class="space">&hellip;</span><a class="page-number" href="/tpaaaaaa.github.io/page/25/">25</a><a class="extend next" rel="next" href="/tpaaaaaa.github.io/page/17/"><i class="fa fa-angle-right" aria-label="accessibility.next_page"></i></a>
 </nav>

          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/tpaaaaaa.github.io/images/avatar.gif"
                alt="我玩维恩不学q" />
            
              <p class="site-author-name" itemprop="name">我玩维恩不学q</p>
              <p class="site-description motion-element" itemprop="description">个人blog</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/tpaaaaaa.github.io/archives">
              
                  <span class="site-state-item-count">245</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/tpaaaaaa.github.io/categories/index.html">
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tpaaaaaa.github.io/tags/index.html">
                  <span class="site-state-item-count">113</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">我玩维恩不学q</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/tpaaaaaa.github.io/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/tpaaaaaa.github.io/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/tpaaaaaa.github.io/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/tpaaaaaa.github.io/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/tpaaaaaa.github.io/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/tpaaaaaa.github.io/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/tpaaaaaa.github.io/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/tpaaaaaa.github.io/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/tpaaaaaa.github.io/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/tpaaaaaa.github.io/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/tpaaaaaa.github.io/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/tpaaaaaa.github.io/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
